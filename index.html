<script>
  // ✅ 使用生产 URL（不要用 -test）
  const N8N_WEBHOOK_URL = "https://fuzewen.app.n8n.cloud/webhook/hooks/audit";

  const form = document.getElementById('lead-form');
  const msg  = document.getElementById('msg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = "Submitting...";

    // 收集表单并补充系统字段
    const data = Object.fromEntries(new FormData(form).entries());
    data.submitted_at = new Date().toISOString();
    data.user_agent   = navigator.userAgent;

    try {
      const res = await fetch(N8N_WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (!res.ok) throw new Error('Non-200 from webhook');

      // 成功后跳转到感谢页
      window.location.href = './thanks.html';
    } catch (err) {
      console.error(err);
      msg.textContent = "提交失败，请稍后重试。";
    }
  });
</script>
